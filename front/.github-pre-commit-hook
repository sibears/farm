#!/usr/bin/env bash
# Pre-commit hook –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º
#
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞:
#   cp .github-pre-commit-hook .git/hooks/pre-commit
#   chmod +x .git/hooks/pre-commit
#
# –ò–ª–∏:
#   ln -s ../../front/.github-pre-commit-hook .git/hooks/pre-commit

set -e

# –¶–≤–µ—Ç–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

echo -e "${YELLOW}üîç Pre-commit –ø—Ä–æ–≤–µ—Ä–∫–∏...${NC}"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ front
if [ ! -f "package.json" ]; then
    cd front
fi

# –ë—ã—Å—Ç—Ä—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
echo -e "${YELLOW}üìù –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...${NC}"
if ! bun run format:check; then
    echo -e "${RED}‚ùå –ö–æ–¥ –Ω–µ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω${NC}"
    echo -e "${YELLOW}–ó–∞–ø—É—Å—Ç–∏—Ç–µ: bun run format${NC}"
    exit 1
fi

echo -e "${YELLOW}üîç –õ–∏–Ω—Ç–∏–Ω–≥...${NC}"
if ! bun run lint; then
    echo -e "${RED}‚ùå –û—à–∏–±–∫–∏ –ª–∏–Ω—Ç–∏–Ω–≥–∞${NC}"
    echo -e "${YELLOW}–ó–∞–ø—É—Å—Ç–∏—Ç–µ: bun run lint:fix${NC}"
    exit 1
fi

echo -e "${GREEN}‚úÖ Pre-commit –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã${NC}"


